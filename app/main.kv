#:import C kivy.utils.get_color_from_hex
#:import os os

<ScreenManagement>:
    ListScreen:

##################################################
<TouchImage>:
    canvas.before:
        Color:
            rgb: 59/255, 109/255, 199/255
        Rectangle:
            pos:self.pos
            size:self.size
    on_touch_down: self.on_touch_down
<ListScreen>:
    name: 'ListPage'
    id: screen1

    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgb:0/255., 0/255., 0/255.
            Rectangle:
                pos: self.pos
                size: self.size
        ######## menu part ########
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y:0.1
            padding:3
            ActionBar:
                pos_hint: {'top':1}
                ActionView:
                    use_separator: True
                    ActionPrevious:
                        title: 'THT Soldering Robot'
                        size_hint_x: 0.2
                        with_previous: False
                    ActionGroup:
                        text: 'File'
                        size_hint_x: 0.15 
                        mode: 'spinner'
                        ActionButton:
                            text: 'New Project'
                            on_press: root.new_file()
                        ActionButton:
                            text: 'Load Project'
                            on_press: root.load_file()
                        ActionButton:
                            text: 'Save Project'
                            on_press: root.save_file()
                        ActionButton:
                            text: 'Save Project As'
                            on_press: root.save_as_file()
                        ActionButton:
                            text: 'Exit Project'
                            on_press: app.stop()
                    ActionGroup:
                        text: 'Program'
                        size_hint_x: 0.25 
                        mode: 'normal'
                        ActionButton:
                            text: 'Import NC Drill'
                            on_press: root.import_nc()
                        ActionButton:
                            text: 'Select Soldering profile'
                            on_press: root.select_profile()
                        ActionButton:
                            text: 'Select soldering pad by diameter'
                            on_press: root.select_by_dia()
                        ActionButton:
                            text: 'Select soldering pad in view'
                            on_press: root.select_by_view()
                        ActionButton:
                            text: 'Deselect soldering pad in view'
                            on_press: root.deselect_by_view()
                        ActionButton:
                            text: 'Set Reference Point 1'
                            on_press: root.set_reference1()
                        ActionButton:
                            text: 'Set Reference Point 2'
                            on_press: root.set_reference2()
                        ActionButton:
                            text: 'Optimize Soldering Point order'
                            on_press: root.optmize_nc()
                    ActionGroup:
                        text: 'Panel'
                        size_hint_x: 0.25 
                        mode: 'spinner'
                        ActionButton:
                            text: 'Set Number of Panel'
                            on_press: root.set_num_panel()
                        ActionButton:
                            text: 'Set Reference Points for Panel'
                            on_press: root.set_reference_panel()
                    ActionGroup:
                        text: 'Connect'
                        size_hint_x: 0.15 
                        mode: 'spinner'
                        ActionButton:
                            text: 'Set Printer Port'
                            on_press: root.set_printer()
                        ActionButton:
                            text: 'Set Camera Port'
                            on_press: root.set_camera()
        
        ####### toolbar part ######        
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y:0.03
            Label:
                text:''
                size_hint_x: 0.1
                font_size:16
                
            Button:
                id: btn_start
                text:'start soldering'
                size_hint: 0.2, None
                height: 40
                font_size:24
                background_color: 208/255, 128/255, 34/255, 1
                background_normal: ""
                on_press: root.start_soldering()
            Label:
                text:''
                size_hint_x: 0.1
                font_size:16
            Button:
                id: btn_stop
                text:'stop soldering'
                size_hint: 0.2, None
                height: 40
                font_size:24
                background_color: 208/255, 128/255, 34/255, 1
                background_normal: ""
                on_press: root.stop_soldering()
            Label:
                text:''
                size_hint_x: 0.1
                font_size:16  
            Button:
                id: btn_test
                text:'test soldering'
                size_hint: 0.2, None
                height: 40
                font_size:24
                background_color: 208/255, 128/255, 34/255, 1
                background_normal: ""
                on_press: root.test_soldering()
            Label:
                text:''
                size_hint_x: 0.1
                font_size:16                 
            
        ####### body part ##########       
        BoxLayout:
            orientation: 'vertical'
            size_hint_y:0.72
            padding: 3
            TabbedPanel:
                do_default_tab: False
                TabbedPanelItem:
                    text: ' CAD '
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint: 1, 1
                        BoxLayout:
                            size_hint_x: 0.5
                            padding: 5
                            TouchImage:
                                id: img_cad_origin

                        BoxLayout:
                            size_hint_x: 0.5
                            padding: 5
                            Image:
                                id: img_cad_selected
                                
                TabbedPanelItem:
                    text: ' Camera '

        ####### status part ######
        # footer part    
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y:0.05
            padding: 3
            Label:
                id: lbl_cad_cam
                text:''
                size_hint: 0.5, 1
                font_size:20
                
            Label:
                id: lbl_solder_status
                text:''
                size_hint: 0.5, 1
                font_size:20
                
################################
<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            filters: ['*.txt','*.TXT']
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, text_input.text)
########## select soldering profile ######
<ListPopup>
    BoxLayout:
        id: profile_list
        orientation: 'vertical'
        padding:8
<EditPopup>
    BoxLayout:
        orientation: 'vertical'
        padding:8
        BoxLayout:
            size_hint_y: 0.5
            TextInput:
                id: text_port
                font_size: 24
                size_hint_y: None
                height: 40
                multiline: False
        BoxLayout:
            size_hint_y: 0.5
            
            Button:
                text: "Cancel"
                size_hint_y: None
                height: 40
                on_release: root.cancel()
            Button:
                id: btn_connect
                text: "Connect"
                size_hint_y: None
                height: 40
                on_release: root.save(text_port.text)
